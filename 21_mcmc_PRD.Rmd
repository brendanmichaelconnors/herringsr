# Prince Rupert District diagnostics

This section contains MCMC diagnostics for the Prince Rupert District major stock assessment region SCA model.
These tables and figures will not be included in the final Science Response.

```{r prd-priors-posts-figure, fig.cap = "Prior probability distributions (lines) with comparative posterior histograms (bars) used in the Prince Rupert District major stock assessment region. Subscripts on $q$ (catchability) indicate: 1 = surface survey, 2 = dive survey. The dotted red lines are the maximum posterior density estimates."}
make.priors.posts.plot(major_models[[model_ind]],
                       priors.only = FALSE)
```

```{r prd-traces-figure, fig.asp=1, fig.cap = paste0("Trace plots for MCMC output of estimated parameters for the Prince Rupert District major stock assessment region. The MCMC run had chain length ", mcmc_length, " with a sample taken at every ", f(mcmc_samp_freq), "th iteration. Subscripts on $q$ (catchability) indicate: 1 = surface survey, 2 = dive survey. Parameters $\\hat{a}_k$ (selectivity-at-age-50\\%), and $\\hat{\\gamma}_k$ (selectivity standard deviation-at-50\\%) represent gears as follows: $k=1$: other fisheries, $k=2$: roe seine, $k=3$: roe gillnet.")}
make.traces.plot(major_models[[model_ind]],
                 axis.lab.freq = 200)
```

(ref:prd-autocor-figure) Autocorrelation plots for MCMC output of estimated parameters for the Prince Rupert District major stock assessment region. See Figure \@ref(fig:prd-traces-figure) for parameter descriptions.
```{r prd-autocor-figure, fig.asp=1, fig.cap = "(ref:prd-autocor-figure)"}
make.autocor.plot(major_models[[model_ind]])
```

(ref:prd-pairs-figure) Pairs plots for MCMC output of estimated parameters for the Prince Rupert District major stock assessment region. See Figure \@ref(fig:prd-traces-figure) for parameter descriptions.
```{r prd-pairs-figure, fig.asp=1, fig.cap = "(ref:prd-pairs-figure)"}
make.pairs.plot(major_models[[model_ind]])
```

(ref:prd-biomass-retro-figure) Maximum posterior density biomass with retrospectivces for the Prince Rupert District major stock assessment region.
```{r prd-biomass-retro-figure, fig.cap = "(ref:prd-biomass-retro-figure)"}
biomass.plot.mpd(major_models[[model_ind]])
```

(ref:decision-table-prd) `r paste0("Projected spawning biomass for ", assess_yr + 1, " compared to harvest rate and TAC for the Prince Rupert District, rows 1-4 in Table \\@ref(tab:decision-table-prd)")`
```{r hcr-prd, fig.cap = "(ref:decision-table-prd)"}
region <- "PRD"
probs <- confidence_vals
cowplot::plot_grid(plot_hcr(mp.lst.prd[[1]][[1]],
                            sbt.prd,
                            mp = mp.prd[1,]$label,
                            region = region,
                            probs = probs),
                   plot_hcr(mp.lst.prd[[1]][[2]],
                            sbt.prd,
                            mp = mp.prd[2,]$label,
                            region = region,
                            probs = probs),
                   plot_hcr(mp.lst.prd[[1]][[3]],
                            sbt.prd,
                            mp = mp.prd[3,]$label,
                            region = region,
                            probs = probs,
                            show.x.axes = TRUE),
                   plot_hcr(mp.lst.prd[[1]][[4]],
                            sbt.prd,
                            mp = mp.prd[4,]$label,
                            region = region,
                            probs = probs,
                            show.x.axes = TRUE),
                   nrow = 2,
                   ncol = 2,
                   align = "hv",
                   axis = "tblr")
```

(ref:decision-table-prd-2) `r paste0("Projected spawning biomass for ", assess_yr + 1, " compared to harvest rate and TAC for the Prince Rupert District, rows 5-8 in Table \\@ref(tab:decision-table-prd)")`
```{r hcr-prd-2, fig.cap = "(ref:decision-table-prd-2)"}
region <- "PRD"
probs <- confidence_vals 
cowplot::plot_grid(plot_hcr(mp.lst.prd[[1]][[5]],
                            sbt.prd,
                            mp = mp.prd[5,]$label,
                            region = region,
                            probs = probs),
                   plot_hcr(mp.lst.prd[[1]][[6]],
                            sbt.prd,
                            mp = mp.prd[6,]$label,
                            region = region,
                            probs = probs),
                   plot_hcr(mp.lst.prd[[1]][[7]],
                            sbt.prd,
                            mp = mp.prd[7,]$label,
                            region = region,
                            probs = probs,
                            show.x.axes = TRUE),
                   plot_hcr(mp.lst.prd[[1]][[8]],
                            sbt.prd,
                            mp = mp.prd[8,]$label,
                            region = region,
                            probs = probs,
                            show.x.axes = TRUE),
                   nrow = 2,
                   ncol = 2,
                   align = c("v", "h"))
```

(ref:decision-table-prd-3) `r paste0("Projected spawning biomass for ", assess_yr + 1, " compared to harvest rate and TAC for the Prince Rupert District, rows 9-10 in Table \\@ref(tab:decision-table-prd)")`
```{r hcr-prd-3, fig.cap = "(ref:decision-table-prd-3)"}
region <- "PRD"
probs <- confidence_vals 
cowplot::plot_grid(plot_hcr(mp.lst.prd[[1]][[9]],
                            sbt.prd,
                            mp = mp.prd[9,]$label,
                            region = region,
                            probs = probs,
                            show.x.axes = TRUE),
                   plot_hcr(mp.lst.prd[[1]][[10]],
                            sbt.prd,
                            mp = mp.prd[10,]$label,
                            region = region,
                            probs = probs,
                            show.x.axes = TRUE),
                   nrow = 2,
                   ncol = 1,
                   align = c("v", "h"))
```

