# Figures

(ref:bc-map-cap) Boundaries for the Pacific Herring stock assessment regions (SARs) in BC.
The major SARs are Haida Gwaii (HG), Prince Rupert District (PRD), Central Coast (CC), Strait of Georgia (SoG), and West Coast of Vancouver Island (WCVI).
The minor SARs are Area 27 (A27) and Area 2 West (A2W).
Units: kilometres (km).

(ref:bc-map-cap-french) Limites des régions d’évaluation des stocks du hareng du Pacifique en Colombie-Britannique.
Les principales régions d’évaluation des stocks sont Haida Gwaii (HG), le district de Prince Rupert (DPR), la côte centrale (CC), le détroit de Georgie (DG) et la côte ouest de l’île de Vancouver (COIV).
Les régions d’évaluation des stocks secondaires sont la zone 27 (Z27) et la zone 2 Ouest (Z2O). 
Unités: kilomètres (km).

```{r bc-map, fig.cap = ifelse(french, "(ref:bc-map-cap-french)", "(ref:bc-map-cap)"), out.width = "100%", fig.pos="H"}
knitr::include_graphics(here::here(ifelse(french, "figures/BC-FR.png", "figures/BC.png")))
```

(ref:major-catch-cap) Time series of total landed catch in thousands of tonnes (t) of Pacific Herring from `r recent_catch_yr` to `r major_end_yr` in the major stock assessment regions.
See Figures \@ref(fig:storyboard-hg) to \@ref(fig:storyboard-wcvi) for catches during the reduction period (`r major_start_yr` to `r recent_catch_yr-1`).
Legend: 'Other' represents the reduction, the food and bait, as well as the special use fishery; 'RoeGN' represents the roe gillnet fishery; and 'RoeSN' represents the roe seine fishery.

(ref:major-catch-cap-french) `r paste0("Série chronologique des prises totales débarquées en milliers de tonnes (t) de hareng du Pacifique de ", recent_catch_yr, " à ", major_end_yr, " dans les principales régions d’évaluation des stocks. Légende: « Autre » représente la réduction, ainsi que les pêches pratiquées à des fins de subsistance, pour le marché des appâts et pour des usages spéciaux; « RogueFM » représente la pêche au hareng rogué au filet maillant; et « RogueSN » représente la pêche au hareng rogué à la senne.")`

```{r major-catch, fig.asp = 1.1, fig.cap = ifelse(french, "(ref:major-catch-cap-french)", "(ref:major-catch-cap)")}
plot_catch(major_catch,
           xlim = c(recent_catch_yr, major_end_yr),
           translate = french)
```

(ref:major-wa-cap) `r paste0("Time series of weight-at-age in kilograms (kg) for age-", age_highlight, " (circles) and ", nRollWA, "-year running mean weight-at-age (lines) for Pacific Herring from ", major_start_yr, " to ", major_end_yr, " in the major stock assessment regions. Lines show ", nRollWA, "-year running means for age-", min(as.integer(names(minor_wa)), na.rm=TRUE), " to age-", age_plus, " herring (incrementing higher from the lowest line); the thick black line highlights age-", age_highlight, " herring. Missing weight-at-age values (i.e., years where there are no biological samples) are imputed using one of two methods: missing values at the beginning of the time series are imputed by extending the frst non-missing value backwards; other missing values are imputed as the mean of the previous ", nRollWA, " years. Biological summaries only include samples collected using seine nets (commercial and test) due to size-selectivity of other gear types such as gillnet. The age-",  age_plus, " class is a 'plus group' which includes fish ages ", age_plus, " and older. Note that vertical axes are cropped at ", wa_ylim[1], " and ", wa_ylim[2], " kg.")`

<!-- Need to fix automation (i.e., age-3) in french captions, here and elsewhere -->

(ref:major-wa-cap-french) `r paste0("Série chronologique du poids selon l’âge en kilogrammes (kg) pour les poissons de 3 ans (cercles) et des moyennes mobiles sur 5 ans du poids selon l’âge (lignes) pour le hareng du Pacifique de ", major_start_yr, " à ", assess_yr, " dans les principales régions d’évaluation des stocks. Les lignes indiquent les moyennes mobiles sur 5 ans pour le hareng âgé de 2 à 10 ans (en ordre croissant à partir de la ligne inférieure); la ligne noire épaisse met en évidence le hareng âgé de 3 ans. Les valeurs manquantes du poids selon l’âge (c.-à-d. les années où il n’y a pas d’échantillons biologiques) sont imputées selon l’une des deux méthodes suivantes : les valeurs manquantes au début de la série chronologique sont imputées en étendant la première valeur non manquante à rebours; les autres valeurs manquantes sont imputées comme la moyenne des cinq années précédentes. Les résumés biologiques ne comprennent que les échantillons prélevés à l’aide de sennes (pêche commerciale et pêche d’essai) en raison de la sélectivité par taille des autres types d’engins tels que les filets maillants. La classe des poissons âgés de ", age_plus, " ans est un groupe « plus » qui comprend les poissons âgés de ", age_plus, " ans et plus. Notez que les axes verticaux sont coupés à ", wa_ylim[1], " et ", wa_ylim[2], " kg.")`

```{r major-wa, fig.asp = 1, fig.cap = ifelse(french, "(ref:major-wa-cap-french)", "(ref:major-wa-cap)")}
plot_wa(major_wa,
        circle_age = age_highlight,
        xlim = c(major_start_yr, major_end_yr),
        ylim = wa_ylim,
        n_roll = nRollWA,
        translate = french)

```

(ref:major-pa-cap) `r paste0("Time series of proportion-at-age for Pacific Herring from ", major_start_yr, " to ", major_end_yr, " in the major stock assessment regions. The black line is the mean age, and the shaded area is the approximate ", ci_level*100, "\\% distribution. Biological summaries only include samples collected using seine nets (commercial and test) due to size-selectivity of other gear types such as gillnet. The age-", age_plus, " class is a 'plus group' which includes fish ages ", age_plus, " and older.")`

(ref:major-pa-cap-french) `r paste0("Série chronologique de la proportion selon l’âge pour le hareng du Pacifique de ", major_start_yr, " à ", assess_yr, " dans les principales régions d’évaluation des stocks. La ligne noire correspond à l’âge moyen et la zone ombragée à la distribution d’environ 90 %. Les résumés biologiques ne comprennent que les échantillons prélevés à l’aide de sennes (pêche commerciale et pêche d’essai) en raison de la sélectivité par taille des autres types d’engins tels que les filets maillants. La classe des poissons âgés de ", age_plus, " ans est un groupe « plus » qui comprend les poissons âgés de ", age_plus, " ans et plus.")`

```{r major-pa, fig.asp = 1.1, fig.cap = ifelse(french, "(ref:major-pa-cap-french)", "(ref:major-pa-cap)")}
plot_pa(major_pa,
        age_plus = age_plus,
        conf = ci_level,
        xlim = c(major_start_yr, major_end_yr),
        ylim = c(1, age_plus),
        translate = french)

```

(ref:major-spawn-index-cap) `r paste0("Time series of spawn index in thousands of tonnes (t) for Pacific Herring from ", major_start_yr, " to ", major_end_yr, " in the major stock assessment regions. The spawn index has two distinct periods defned by the dominant survey method: surface surveys (",  minor_start_yr, " to ", new_surv_yr-1, "), and dive surveys (", new_surv_yr, " to ", minor_end_yr, "). The dashed vertical line is the boundary between these two periods. The 'spawn index' represents the raw survey data only, and is not scaled by the spawn survey scaling parameter $q$.")`

(ref:major-spawn-index-cap-french) `r paste0("Série chronologique de l’indice du frai en milliers de tonnes pour le hareng du Pacifique de ", major_start_yr, " à ", assess_yr, " dans les principales régions d’évaluation des stocks. L’indice du frai comporte deux périodes distinctes définies par la méthode de relevé dominante : relevés en surface (de ", major_start_yr, " à ", new_surv_yr - 1, ") et relevés de plongée (de ", new_surv_yr, " à ", assess_yr, "). La ligne verticale en pointillés est la limite entre ces deux périodes. L’indice du frai représente uniquement les données brutes de relevé et n’est pas mis à l’échelle à l’aide du paramètre de mise à l’échelle du relevé du frai, q.")`

```{r major-spawn-index, fig.asp = 1.1, fig.cap = ifelse(french, "(ref:major-spawn-index-cap-french)", "(ref:major-spawn-index-cap)")}
plot_spawn_ind(major_surv,
               xlim = c(major_start_yr, major_end_yr),
               new_surv_yr = new_surv_yr,
               translate = french)
```

<!-- Haida Gwaii Storyboard -->
```{r scaled-abundance-hg, fig.show = "hide", fig.asp = 1}
model_ind <- match(en2fr("HG", french), major_regions_short)
sbt_yrs <- as.numeric(colnames(major_models[[model_ind]]$mcmccalcs$sbt.quants ))
xlim_all <- c(min(sbt_yrs) - 1, max(sbt_yrs) + 1)
ct <- major_catch %>% filter(region == major_regions_full[model_ind])
x_axis_label_newline_length <- 50
y_axis_label_newline_length <- 50
x_axis_label_size = 8
x_axis_tick_label_size = 8
y_axis_label_size = 8
y_axis_tick_label_size = 8

plot_a <- plot_scaled_abundance(major_surv %>% filter(region == major_regions_full[model_ind]),
                                major_models[[model_ind]],
                                surv_type,
                                new_surv_yr = new_surv_yr,
                                point_size = 1,
                                line_size = 1,
                                xlim = xlim_all,
                                show_x_axis = FALSE,
                                show_y_axis = TRUE,
                                x_axis_label_size = x_axis_label_size,
                                x_axis_tick_label_size = x_axis_tick_label_size,
                                y_axis_label_size = y_axis_label_size,
                                y_axis_tick_label_size = y_axis_tick_label_size,
                                x_axis_label_newline_length = x_axis_label_newline_length,
                                y_axis_label_newline_length = y_axis_label_newline_length,
                                annot = "a",
                                show_legend = FALSE,
                                translate = french)
```
<!-- Haida Gwaii Storyboard -->
```{r natural-mortality-hg, fig.show = "hide", fig.asp = 1}
plot_b <- plot_natural_mortality(major_models[[model_ind]],
                                 line_size = 1,
                                 ribbon_alpha = 0.5,
                                 xlim = xlim_all,
                                 show_x_axis = FALSE,
                                 show_y_axis = TRUE,
                                 x_axis_label_size = x_axis_label_size,
                                 x_axis_tick_label_size = x_axis_tick_label_size,
                                 y_axis_label_size = y_axis_label_size,
                                 y_axis_tick_label_size = y_axis_tick_label_size,
                                 x_axis_label_newline_length = x_axis_label_newline_length,
                                 y_axis_label_newline_length = y_axis_label_newline_length,
                                 annot = "b",
                                 translate = french)
```
<!-- Haida Gwaii Storyboard -->
```{r recruitment-hg, fig.show = "hide", fig.asp = 1}
plot_c <- plot_recruitment(major_models[[model_ind]],
                           point_size = 1,
                           line_size = 1,
                           xlim = xlim_all,
                           show_x_axis = FALSE,
                           show_y_axis = TRUE,
                           x_axis_label_size = x_axis_label_size,
                           x_axis_tick_label_size = x_axis_tick_label_size,
                           y_axis_label_size = y_axis_label_size,
                           y_axis_tick_label_size = y_axis_tick_label_size,
                           x_axis_label_newline_length = x_axis_label_newline_length,
                           y_axis_label_newline_length = y_axis_label_newline_length,
                           annot = "c",
                           translate = french)
```
<!-- Haida Gwaii Storyboard -->
```{r biomass-catch-hg, fig.show = "hide", fig.asp = 1}
plot_d <- plot_biomass_catch(major_models[[model_ind]],
                             ct,
                             point_size = 1,
                             errorbar_size = 0.5,
                             line_size = 1,
                             ribbon_alpha = 0.5,
                             lrp_ribbon_alpha = 0.35,
                             # between_bars = 0.5,
                             refpt_show = "0.3sbo",
                             xlim = xlim_all,
                             show_x_axis = FALSE,
                             show_y_axis = TRUE,
                             x_axis_label_size = x_axis_label_size,
                             x_axis_tick_label_size = x_axis_tick_label_size,
                             y_axis_label_size = y_axis_label_size,
                             y_axis_tick_label_size = y_axis_tick_label_size,
                             x_axis_label_newline_length = x_axis_label_newline_length,
                             y_axis_label_newline_length = y_axis_label_newline_length,
                             annot = "d",
                             translate = french)
```
<!-- Haida Gwaii Storyboard -->
```{r recruitment-devs-hg, fig.show = "hide", fig.asp = 1}
plot_e <- plot_recruitment_devs(major_models[[model_ind]],
                                run_mean_yrs = nRollRec,
                                point_size = 1,
                                line_size = 0.5,
                                errorbar_size = 0.5,
                                zeroline_size = 0.5,
                                zeroline_type = "dashed",
                                xlim = xlim_all,
                                show_x_axis = TRUE,
                                show_y_axis = TRUE,
                                x_axis_label_size = x_axis_label_size,
                                x_axis_tick_label_size = x_axis_tick_label_size,
                                y_axis_label_size = y_axis_label_size,
                                y_axis_tick_label_size = y_axis_tick_label_size,
                                x_axis_label_newline_length = x_axis_label_newline_length,
                                y_axis_label_newline_length = y_axis_label_newline_length,
                                annot = "e",
                                translate = french)
```
<!-- Haida Gwaii Storyboard -->
```{r biomass-phase-hg, fig.show = "hide", fig.asp = 1}
plot_f <- plot_biomass_phase(major_models[[model_ind]],
                             ct,
                             new_surv_yr = new_surv_yr,
                             point_size = 2.5,
                             line_size = 0.5,
                             path_line_size = 0.4,
                             text_size = 2,
                             zeroline_size = 0.5,
                             zeroline_type = "dashed",
                             lrp_ribbon_alpha = 0.35,
                             refpt_show = "0.3sbo",
                             show_x_axis = TRUE,
                             show_y_axis = TRUE,
                             x_axis_label_size = x_axis_label_size,
                             x_axis_tick_label_size = x_axis_tick_label_size,
                             y_axis_label_size = y_axis_label_size,
                             y_axis_tick_label_size = y_axis_tick_label_size,
                             x_axis_label_newline_length = x_axis_label_newline_length,
                             y_axis_label_newline_length = y_axis_label_newline_length,
                             annot = "f",
                             translate = french)
```
<!-- Haida Gwaii Storyboard -->
(ref:storyboard-hg-cap) Model output for Pacific Herring in the Haida Gwaii major stock assessment region.
Panel (a): model fit to scaled spawn survey data in thousands of tonnes (t).
Spawn survey data (i.e., spawn index) is scaled to abundance by the spawn survey scaling parameter $q$.
Panel (b): posterior estimates of instantaneous natural mortality rate.
Panel (c): reconstructed number of age-2 recruits in thousands of millions.
Panel (d): posterior estimate of spawning biomass $\mli{SB_t}$ in year $t$ in thousands of tonnes.
Circle and vertical line indicate the median and `r ci_level*100`% credible interval, respectively, of forecast spawning biomass in `r assess_yr+1` in the absense of fishing.
Vertical bars indicate commercial catch $C_t$, excluding spawn-on-kelp (see Figure \@ref(fig:major-catch) for legend).
Panels (b & d): lines and shaded areas indicate medians and `r ci_level*100`% credible intervals, respectively.
Panel (e): log recruitment deviations.
Panels (c & e): circles and vertical lines indicate medians and `r ci_level*100`% credible intervals, respectively.
Panel (f): phase plot of spawning biomass production ($\frac{\mli{SB}_{t+1} - \mli{SB}_t + C_{t+1}}{\mli{SB}_t}$) for the dive survey period (`r new_surv_yr` to `r assess_yr-1`; maximum posterior density estimates).
Grey shading becomes darker in chronological order; the triangle indicates `r assess_yr-1`.
Panels (d & f): red lines and shading indicate medians and `r ci_level*100`% confdence intervals, respectively, for the limit reference point $0.3\mli{SB}_0$, where $\mli{SB}_0$ is estimated unfished biomass.

<!-- The red line is the ", nRollRec, "-year running mean of the median recruitment deviation. -->

(ref:storyboard-hg-cap-french) `r paste0("Production d’un modèle pour le hareng du Pacifique dans la principale région d’évaluation des stocks de Haida Gwaii. Panneau (a) : ajustement du modèle aux données mises à l’échelle de relevé du frai en milliers de tonnes métriques. Les données de relevé du frai (l’indice du frai) sont mises à l’échelle de l’abondance à l’aide du paramètre de mise à l’échelle du relevé du frai q. Panneau (b) : estimations a posteriori du taux de mortalité naturelle instantanée. Panneau (c) : nombre reconstitué de recrues d’âge 2 en milliers de millions. Panneau (d) : estimation a posteriori de la biomasse reproductrice ($BSR_t$) pour chaque année t en milliers de tonnes. Le cercle et la ligne verticale indiquent la médiane et l’intervalle de crédibilité de 90\\%, respectivement, de la $BSR_{", assess_yr + 1, "}$ (avant la pêche). Les barres verticales indiquent les prises commerciales, à l’exclusion des prises d’oeufs sur varech. Panneaux (b et d) : les lignes et les zones ombragées indiquent les médianes et les intervalles de crédibilité de 90\\%, respectivement. Panneau (e) : log des écarts du recrutement. La ligne rouge correspond à la moyenne mobile sur trois ans de l’écart médian de recrutement. Panneaux (c et e) : les cercles et les lignes verticales indiquent les médianes et les intervalles de crédibilité de 90\\%, respectivement. Panneau (f) : diagramme de phase de la production de la biomasse reproductrice pour la période du relevé de plongée (de ", new_surv_yr, " à ", assess_yr,  "; estimations de la densité maximale a posteriori). L’ombrage gris est de plus en plus foncé à mesure que l’on avance dans la série chronologique; le triangle indique ", assess_yr - 1, ". Panneaux (d et f) : les lignes rouges et l’ombrage indiquent les médianes et les intervalles de confiance de 90\\%, respectivement, pour le point de référence limite, $0,3BSR_0$.")`

```{r storyboard-hg, out.height="6.5in", fig.asp=1, fig.cap = ifelse(french, "(ref:storyboard-hg-cap-french)", "(ref:storyboard-hg-cap)")}

cowplot::plot_grid(plot_a,
                   plot_b,
                   plot_c,
                   plot_d,
                   plot_e,
                   plot_f,
                   ncol = 2,
                   align = "v",
                   rel_heights = c(1.0, 1.0, 1.1))

```

<!-- Prince Rupert District Storyboard -->
```{r scaled-abundance-prd, fig.show = "hide", fig.asp = 1}
model_ind <- match(en2fr("PRD", french), major_regions_short)
sbt_yrs <- as.numeric(colnames(major_models[[model_ind]]$mcmccalcs$sbt.quants ))
xlim_all <- c(min(sbt_yrs) - 1, max(sbt_yrs) + 1)
ct <- major_catch %>% filter(region == major_regions_full[model_ind])

plot_a <- plot_scaled_abundance(major_surv %>% filter(region == major_regions_full[model_ind]),
                                major_models[[model_ind]],
                                surv_type,
                                new_surv_yr = new_surv_yr,
                                point_size = 1,
                                line_size = 1,
                                xlim = xlim_all,
                                show_x_axis = FALSE,
                                show_y_axis = TRUE,
                                x_axis_label_size = x_axis_label_size,
                                x_axis_tick_label_size = x_axis_tick_label_size,
                                y_axis_label_size = y_axis_label_size,
                                y_axis_tick_label_size = y_axis_tick_label_size,
                                x_axis_label_newline_length = x_axis_label_newline_length,
                                y_axis_label_newline_length = y_axis_label_newline_length,
                                annot = "a",
                                show_legend = FALSE,
                                translate = french)
```
<!-- Prince Rupert District Storyboard -->
```{r natural-mortality-prd, fig.show = "hide", fig.asp = 1}
plot_b <- plot_natural_mortality(major_models[[model_ind]],
                                 line_size = 1,
                                 ribbon_alpha = 0.5,
                                 xlim = xlim_all,
                                 show_x_axis = FALSE,
                                 show_y_axis = TRUE,
                                 x_axis_label_size = x_axis_label_size,
                                 x_axis_tick_label_size = x_axis_tick_label_size,
                                 y_axis_label_size = y_axis_label_size,
                                 y_axis_tick_label_size = y_axis_tick_label_size,
                                 x_axis_label_newline_length = x_axis_label_newline_length,
                                 y_axis_label_newline_length = y_axis_label_newline_length,
                                 annot = "b",
                                 translate = french)
```
<!-- Prince Rupert District Storyboard -->
```{r recruitment-prd, fig.show = "hide", fig.asp = 1}
plot_c <- plot_recruitment(major_models[[model_ind]],
                           point_size = 1,
                           line_size = 1,
                           xlim = xlim_all,
                           show_x_axis = FALSE,
                           show_y_axis = TRUE,
                           x_axis_label_size = x_axis_label_size,
                           x_axis_tick_label_size = x_axis_tick_label_size,
                           y_axis_label_size = y_axis_label_size,
                           y_axis_tick_label_size = y_axis_tick_label_size,
                           x_axis_label_newline_length = x_axis_label_newline_length,
                           y_axis_label_newline_length = y_axis_label_newline_length,
                           annot = "c",
                           translate = french)
```
<!-- Prince Rupert District Storyboard -->
```{r biomass-catch-prd, fig.show = "hide", fig.asp = 1}
plot_d <- plot_biomass_catch(major_models[[model_ind]],
                             ct,
                             point_size = 1,
                             errorbar_size = 0.5,
                             line_size = 1,
                             ribbon_alpha = 0.5,
                             lrp_ribbon_alpha = 0.35,
                             # between_bars = 0.5,
                             refpt_show = "0.3sbo",
                             xlim = xlim_all,
                             show_x_axis = FALSE,
                             show_y_axis = TRUE,
                             x_axis_label_size = x_axis_label_size,
                             x_axis_tick_label_size = x_axis_tick_label_size,
                             y_axis_label_size = y_axis_label_size,
                             y_axis_tick_label_size = y_axis_tick_label_size,
                             x_axis_label_newline_length = x_axis_label_newline_length,
                             y_axis_label_newline_length = y_axis_label_newline_length,
                             annot = "d",
                             translate = french)
```
<!-- Prince Rupert District Storyboard -->
```{r recruitment-devs-prd, fig.show = "hide", fig.asp = 1}
plot_e <- plot_recruitment_devs(major_models[[model_ind]],
                                run_mean_yrs = nRollRec,
                                point_size = 1,
                                line_size = 0.5,
                                errorbar_size = 0.5,
                                zeroline_size = 0.5,
                                zeroline_type = "dashed",
                                xlim = xlim_all,
                                show_x_axis = TRUE,
                                show_y_axis = TRUE,
                                x_axis_label_size = x_axis_label_size,
                                x_axis_tick_label_size = x_axis_tick_label_size,
                                y_axis_label_size = y_axis_label_size,
                                y_axis_tick_label_size = y_axis_tick_label_size,
                                x_axis_label_newline_length = x_axis_label_newline_length,
                                y_axis_label_newline_length = y_axis_label_newline_length,
                                annot = "e",
                                translate = french)
```
<!-- Prince Rupert District Storyboard -->
```{r biomass-phase-prd, fig.show = "hide", fig.asp = 1}
plot_f <- plot_biomass_phase(major_models[[model_ind]],
                             ct,
                             new_surv_yr = new_surv_yr,
                             point_size = 2.5,
                             line_size = 0.5,
                             path_line_size = 0.4,
                             text_size = 2,
                             zeroline_size = 0.5,
                             zeroline_type = "dashed",
                             lrp_ribbon_alpha = 0.35,
                             refpt_show = "0.3sbo",
                             show_x_axis = TRUE,
                             show_y_axis = TRUE,
                             x_axis_label_size = x_axis_label_size,
                             x_axis_tick_label_size = x_axis_tick_label_size,
                             y_axis_label_size = y_axis_label_size,
                             y_axis_tick_label_size = y_axis_tick_label_size,
                             x_axis_label_newline_length = x_axis_label_newline_length,
                             y_axis_label_newline_length = y_axis_label_newline_length,
                             annot = "f",
                             translate = french)
```
<!-- Prince Rupert District Storyboard -->
(ref:storyboard-prd-cap) Model output for Pacific Herring in the Prince Rupert District major stock assessment region. See Figure \@ref(fig:storyboard-hg) for description.

(ref:storyboard-prd-cap-french) Production d’un modèle pour le hareng du Pacifique dans la principale région d’évaluation des stocks du district de Prince Rupert. Voir la figure \@ref(fig:storyboard-hg) pour une description.

```{r storyboard-prd, out.height="6.5in", fig.asp=1, fig.cap = ifelse(french, "(ref:storyboard-prd-cap-french)", "(ref:storyboard-prd-cap)")}

cowplot::plot_grid(plot_a,
                   plot_b,
                   plot_c,
                   plot_d,
                   plot_e,
                   plot_f,
                   ncol = 2,
                   align = "v",
                   rel_heights = c(1.0, 1.0, 1.1))

```
<!-- Central Coast Storyboard -->
```{r scaled-abundance-cc, fig.show = "hide", fig.asp = 1}
model_ind <- match(en2fr("CC", french), major_regions_short)
sbt_yrs <- as.numeric(colnames(major_models[[model_ind]]$mcmccalcs$sbt.quants ))
xlim_all <- c(min(sbt_yrs) - 1, max(sbt_yrs) + 1)
ct <- major_catch %>% filter(region == major_regions_full[model_ind])

plot_a <- plot_scaled_abundance(major_surv %>% filter(region == major_regions_full[model_ind]),
                                major_models[[model_ind]],
                                surv_type,
                                new_surv_yr = new_surv_yr,
                                point_size = 1,
                                line_size = 1,
                                xlim = xlim_all,
                                show_x_axis = FALSE,
                                show_y_axis = TRUE,
                                x_axis_label_size = x_axis_label_size,
                                x_axis_tick_label_size = x_axis_tick_label_size,
                                y_axis_label_size = y_axis_label_size,
                                y_axis_tick_label_size = y_axis_tick_label_size,
                                x_axis_label_newline_length = x_axis_label_newline_length,
                                y_axis_label_newline_length = y_axis_label_newline_length,
                                annot = "a",
                                show_legend = FALSE,
                                translate = french)
```
<!-- Central Coast Storyboard -->
```{r natural-mortality-cc, fig.show = "hide", fig.asp = 1}
plot_b <- plot_natural_mortality(major_models[[model_ind]],
                                 line_size = 1,
                                 ribbon_alpha = 0.5,
                                 xlim = xlim_all,
                                 show_x_axis = FALSE,
                                 show_y_axis = TRUE,
                                 x_axis_label_size = x_axis_label_size,
                                 x_axis_tick_label_size = x_axis_tick_label_size,
                                 y_axis_label_size = y_axis_label_size,
                                 y_axis_tick_label_size = y_axis_tick_label_size,
                                 x_axis_label_newline_length = x_axis_label_newline_length,
                                 y_axis_label_newline_length = y_axis_label_newline_length,
                                 annot = "b",
                                 translate = french)
```
<!-- Central Coast Storyboard -->
```{r recruitment-cc, fig.show = "hide", fig.asp = 1}
plot_c <- plot_recruitment(major_models[[model_ind]],
                           point_size = 1,
                           line_size = 1,
                           xlim = xlim_all,
                           show_x_axis = FALSE,
                           show_y_axis = TRUE,
                           x_axis_label_size = x_axis_label_size,
                           x_axis_tick_label_size = x_axis_tick_label_size,
                           y_axis_label_size = y_axis_label_size,
                           y_axis_tick_label_size = y_axis_tick_label_size,
                           x_axis_label_newline_length = x_axis_label_newline_length,
                           y_axis_label_newline_length = y_axis_label_newline_length,
                           annot = "c",
                           translate = french)
```
<!-- Central Coast Storyboard -->
```{r biomass-catch-cc, fig.show = "hide", fig.asp = 1}
plot_d <- plot_biomass_catch(major_models[[model_ind]],
                             ct,
                             point_size = 1,
                             errorbar_size = 0.5,
                             line_size = 1,
                             ribbon_alpha = 0.5,
                             lrp_ribbon_alpha = 0.35,
                             # between_bars = 0.5,
                             refpt_show = "0.3sbo",
                             xlim = xlim_all,
                             show_x_axis = FALSE,
                             show_y_axis = TRUE,
                             x_axis_label_size = x_axis_label_size,
                             x_axis_tick_label_size = x_axis_tick_label_size,
                             y_axis_label_size = y_axis_label_size,
                             y_axis_tick_label_size = y_axis_tick_label_size,
                             x_axis_label_newline_length = x_axis_label_newline_length,
                             y_axis_label_newline_length = y_axis_label_newline_length,
                             annot = "d",
                             translate = french)
```
<!-- Central Coast Storyboard -->
```{r recruitment-devs-cc, fig.show = "hide", fig.asp = 1}
plot_e <- plot_recruitment_devs(major_models[[model_ind]],
                                run_mean_yrs = nRollRec,
                                point_size = 1,
                                line_size = 0.5,
                                errorbar_size = 0.5,
                                zeroline_size = 0.5,
                                zeroline_type = "dashed",
                                xlim = xlim_all,
                                show_x_axis = TRUE,
                                show_y_axis = TRUE,
                                x_axis_label_size = x_axis_label_size,
                                x_axis_tick_label_size = x_axis_tick_label_size,
                                y_axis_label_size = y_axis_label_size,
                                y_axis_tick_label_size = y_axis_tick_label_size,
                                x_axis_label_newline_length = x_axis_label_newline_length,
                                y_axis_label_newline_length = y_axis_label_newline_length,
                                annot = "e",
                                translate = french)
```
<!-- Central Coast Storyboard -->
```{r biomass-phase-cc, fig.show = "hide", fig.asp = 1}
plot_f <- plot_biomass_phase(major_models[[model_ind]],
                             ct,
                             new_surv_yr = new_surv_yr,
                             point_size = 2.5,
                             line_size = 0.5,
                             path_line_size = 0.4,
                             text_size = 2,
                             zeroline_size = 0.5,
                             zeroline_type = "dashed",
                             lrp_ribbon_alpha = 0.35,
                             refpt_show = "0.3sbo",
                             show_x_axis = TRUE,
                             show_y_axis = TRUE,
                             x_axis_label_size = x_axis_label_size,
                             x_axis_tick_label_size = x_axis_tick_label_size,
                             y_axis_label_size = y_axis_label_size,
                             y_axis_tick_label_size = y_axis_tick_label_size,
                             x_axis_label_newline_length = x_axis_label_newline_length,
                             y_axis_label_newline_length = y_axis_label_newline_length,
                             annot = "f",
                             translate = french)
```
<!-- Central Coast Storyboard -->
(ref:storyboard-cc-cap) Model output for Pacific Herring in the Central Coast major stock assessment region. See Figure \@ref(fig:storyboard-hg) for description.

(ref:storyboard-cc-cap-french) Production d’un modèle pour le hareng du Pacifique dans la principale région d’évaluation des stocks de la côte centrale. Voir la figure \@ref(fig:storyboard-hg) pour une description.

```{r storyboard-cc, out.height="6.5in", fig.asp=1, fig.cap = ifelse(french, "(ref:storyboard-cc-cap-french)", "(ref:storyboard-cc-cap)")}

cowplot::plot_grid(plot_a,
                   plot_b,
                   plot_c,
                   plot_d,
                   plot_e,
                   plot_f,
                   ncol = 2,
                   align = "v",
                   rel_heights = c(1.0, 1.0, 1.1))

```
<!-- Strait of Georgia Storyboard -->
```{r scaled-abundance-sog, fig.show = "hide", fig.asp = 1}
model_ind <- match(en2fr("SoG", french), major_regions_short)
sbt_yrs <- as.numeric(colnames(major_models[[model_ind]]$mcmccalcs$sbt.quants ))
xlim_all <- c(min(sbt_yrs) - 1, max(sbt_yrs) + 1)
ct <- major_catch %>% filter(region == major_regions_full[model_ind])

plot_a <- plot_scaled_abundance(major_surv %>% filter(region == major_regions_full[model_ind]),
                                major_models[[model_ind]],
                                surv_type,
                                new_surv_yr = new_surv_yr,
                                point_size = 1,
                                line_size = 1,
                                xlim = xlim_all,
                                show_x_axis = FALSE,
                                show_y_axis = TRUE,
                                x_axis_label_size = x_axis_label_size,
                                x_axis_tick_label_size = x_axis_tick_label_size,
                                y_axis_label_size = y_axis_label_size,
                                y_axis_tick_label_size = y_axis_tick_label_size,
                                x_axis_label_newline_length = x_axis_label_newline_length,
                                y_axis_label_newline_length = y_axis_label_newline_length,
                                annot = "a",
                                show_legend = FALSE,
                                translate = french)
```
<!-- Strait of Georgia Storyboard -->
```{r natural-mortality-sog, fig.show = "hide", fig.asp = 1}
plot_b <- plot_natural_mortality(major_models[[model_ind]],
                                 line_size = 1,
                                 ribbon_alpha = 0.5,
                                 xlim = xlim_all,
                                 show_x_axis = FALSE,
                                 show_y_axis = TRUE,
                                 x_axis_label_size = x_axis_label_size,
                                 x_axis_tick_label_size = x_axis_tick_label_size,
                                 y_axis_label_size = y_axis_label_size,
                                 y_axis_tick_label_size = y_axis_tick_label_size,
                                 x_axis_label_newline_length = x_axis_label_newline_length,
                                 y_axis_label_newline_length = y_axis_label_newline_length,
                                 annot = "b",
                                 translate = french)
```
<!-- Strait of Georgia Storyboard -->
```{r recruitment-sog, fig.show = "hide", fig.asp = 1}
plot_c <- plot_recruitment(major_models[[model_ind]],
                           point_size = 1,
                           line_size = 1,
                           xlim = xlim_all,
                           show_x_axis = FALSE,
                           show_y_axis = TRUE,
                           x_axis_label_size = x_axis_label_size,
                           x_axis_tick_label_size = x_axis_tick_label_size,
                           y_axis_label_size = y_axis_label_size,
                           y_axis_tick_label_size = y_axis_tick_label_size,
                           x_axis_label_newline_length = x_axis_label_newline_length,
                           y_axis_label_newline_length = y_axis_label_newline_length,
                           annot = "c",
                           translate = french)
```
<!-- Strait of Georgia Storyboard -->
```{r biomass-catch-sog, fig.show = "hide", fig.asp = 1}
plot_d <- plot_biomass_catch(major_models[[model_ind]],
                             ct,
                             point_size = 1,
                             errorbar_size = 0.5,
                             line_size = 1,
                             ribbon_alpha = 0.5,
                             lrp_ribbon_alpha = 0.35,
                             # between_bars = 0.5,
                             refpt_show = "0.3sbo",
                             xlim = xlim_all,
                             show_x_axis = FALSE,
                             show_y_axis = TRUE,
                             x_axis_label_size = x_axis_label_size,
                             x_axis_tick_label_size = x_axis_tick_label_size,
                             y_axis_label_size = y_axis_label_size,
                             y_axis_tick_label_size = y_axis_tick_label_size,
                             x_axis_label_newline_length = x_axis_label_newline_length,
                             y_axis_label_newline_length = y_axis_label_newline_length,
                             annot = "d",
                             translate = french)
```
<!-- Strait of Georgia Storyboard -->
```{r recruitment-devs-sog, fig.show = "hide", fig.asp = 1}
plot_e <- plot_recruitment_devs(major_models[[model_ind]],
                                run_mean_yrs = nRollRec,
                                point_size = 1,
                                line_size = 0.5,
                                errorbar_size = 0.5,
                                zeroline_size = 0.5,
                                zeroline_type = "dashed",
                                xlim = xlim_all,
                                show_x_axis = TRUE,
                                show_y_axis = TRUE,
                                x_axis_label_size = x_axis_label_size,
                                x_axis_tick_label_size = x_axis_tick_label_size,
                                y_axis_label_size = y_axis_label_size,
                                y_axis_tick_label_size = y_axis_tick_label_size,
                                x_axis_label_newline_length = x_axis_label_newline_length,
                                y_axis_label_newline_length = y_axis_label_newline_length,
                                annot = "e",
                                translate = french)
```
<!-- Strait of Georgia Storyboard -->
```{r biomass-phase-sog, fig.show = "hide", fig.asp = 1}
plot_f <- plot_biomass_phase(major_models[[model_ind]],
                             ct,
                             new_surv_yr = new_surv_yr,
                             point_size = 2.5,
                             line_size = 0.5,
                             path_line_size = 0.4,
                             text_size = 2,
                             zeroline_size = 0.5,
                             zeroline_type = "dashed",
                             lrp_ribbon_alpha = 0.35,
                             refpt_show = "0.3sbo",
                             show_x_axis = TRUE,
                             show_y_axis = TRUE,
                             x_axis_label_size = x_axis_label_size,
                             x_axis_tick_label_size = x_axis_tick_label_size,
                             y_axis_label_size = y_axis_label_size,
                             y_axis_tick_label_size = y_axis_tick_label_size,
                             x_axis_label_newline_length = x_axis_label_newline_length,
                             y_axis_label_newline_length = y_axis_label_newline_length,
                             annot = "f",
                             translate = french)
```
<!-- Strait of Georgia Storyboard -->
(ref:storyboard-sog-cap) Model output for Pacific Herring in the Strait of Georgia major stock assessment region. See Figure \@ref(fig:storyboard-hg) for description.

(ref:storyboard-sog-cap-french) Production d’un modèle pour le hareng du Pacifique dans la principale région d’évaluation des stocks du détroit de Georgie. Voir la figure \@ref(fig:storyboard-hg) pour une description.

```{r storyboard-sog, out.height="6.5in", fig.asp=1, fig.cap = ifelse(french, "(ref:storyboard-sog-cap-french)", "(ref:storyboard-sog-cap)")}

cowplot::plot_grid(plot_a,
                   plot_b,
                   plot_c,
                   plot_d,
                   plot_e,
                   plot_f,
                   ncol = 2,
                   align = "v",
                   rel_heights = c(1.0, 1.0, 1.1))

```
<!-- West Coast of Vancouver Island Storyboard -->
```{r scaled-abundance-wcvi, fig.show = "hide", fig.asp = 1}
model_ind <- match(en2fr("WCVI", french), major_regions_short)
sbt_yrs <- as.numeric(colnames(major_models[[model_ind]]$mcmccalcs$sbt.quants ))
xlim_all <- c(min(sbt_yrs) - 1, max(sbt_yrs) + 1)
ct <- major_catch %>% filter(region == major_regions_full[model_ind])

plot_a <- plot_scaled_abundance(major_surv %>% filter(region == major_regions_full[model_ind]),
                                major_models[[model_ind]],
                                surv_type,
                                new_surv_yr = new_surv_yr,
                                point_size = 1,
                                line_size = 1,
                                xlim = xlim_all,
                                show_x_axis = FALSE,
                                show_y_axis = TRUE,
                                x_axis_label_size = x_axis_label_size,
                                x_axis_tick_label_size = x_axis_tick_label_size,
                                y_axis_label_size = y_axis_label_size,
                                y_axis_tick_label_size = y_axis_tick_label_size,
                                x_axis_label_newline_length = x_axis_label_newline_length,
                                y_axis_label_newline_length = y_axis_label_newline_length,
                                annot = "a",
                                show_legend = FALSE,
                                translate = french)
```
<!-- West Coast of Vancouver Island Storyboard -->
```{r natural-mortality-wcvi, fig.show = "hide", fig.asp = 1}
plot_b <- plot_natural_mortality(major_models[[model_ind]],
                                 line_size = 1,
                                 ribbon_alpha = 0.5,
                                 xlim = xlim_all,
                                 show_x_axis = FALSE,
                                 show_y_axis = TRUE,
                                 x_axis_label_size = x_axis_label_size,
                                 x_axis_tick_label_size = x_axis_tick_label_size,
                                 y_axis_label_size = y_axis_label_size,
                                 y_axis_tick_label_size = y_axis_tick_label_size,
                                 x_axis_label_newline_length = x_axis_label_newline_length,
                                 y_axis_label_newline_length = y_axis_label_newline_length,
                                 annot = "b",
                                 translate = french)
```
<!-- West Coast of Vancouver Island Storyboard -->
```{r recruitment-wcvi, fig.show = "hide", fig.asp = 1}
plot_c <- plot_recruitment(major_models[[model_ind]],
                           point_size = 1,
                           line_size = 1,
                           xlim = xlim_all,
                           show_x_axis = FALSE,
                           show_y_axis = TRUE,
                           x_axis_label_size = x_axis_label_size,
                           x_axis_tick_label_size = x_axis_tick_label_size,
                           y_axis_label_size = y_axis_label_size,
                           y_axis_tick_label_size = y_axis_tick_label_size,
                           x_axis_label_newline_length = x_axis_label_newline_length,
                           y_axis_label_newline_length = y_axis_label_newline_length,
                           annot = "c",
                           translate = french)
```
<!-- West Coast of Vancouver Island Storyboard -->
```{r biomass-catch-wcvi, fig.show = "hide", fig.asp = 1}
plot_d <- plot_biomass_catch(major_models[[model_ind]],
                             ct,
                             point_size = 1,
                             errorbar_size = 0.5,
                             line_size = 1,
                             ribbon_alpha = 0.5,
                             lrp_ribbon_alpha = 0.35,
                             # between_bars = 0.5,
                             refpt_show = "0.3sbo",
                             xlim = xlim_all,
                             show_x_axis = FALSE,
                             show_y_axis = TRUE,
                             x_axis_label_size = x_axis_label_size,
                             x_axis_tick_label_size = x_axis_tick_label_size,
                             y_axis_label_size = y_axis_label_size,
                             y_axis_tick_label_size = y_axis_tick_label_size,
                             x_axis_label_newline_length = x_axis_label_newline_length,
                             y_axis_label_newline_length = y_axis_label_newline_length,
                             annot = "d",
                             translate = french)
```
<!-- West Coast of Vancouver Island Storyboard -->
```{r recruitment-devs-wcvi, fig.show = "hide", fig.asp = 1}
plot_e <- plot_recruitment_devs(major_models[[model_ind]],
                                run_mean_yrs = nRollRec,
                                point_size = 1,
                                line_size = 0.5,
                                errorbar_size = 0.5,
                                zeroline_size = 0.5,
                                zeroline_type = "dashed",
                                xlim = xlim_all,
                                show_x_axis = TRUE,
                                show_y_axis = TRUE,
                                x_axis_label_size = x_axis_label_size,
                                x_axis_tick_label_size = x_axis_tick_label_size,
                                y_axis_label_size = y_axis_label_size,
                                y_axis_tick_label_size = y_axis_tick_label_size,
                                x_axis_label_newline_length = x_axis_label_newline_length,
                                y_axis_label_newline_length = y_axis_label_newline_length,
                                annot = "e",
                                translate = french)
```
<!-- West Coast of Vancouver Island Storyboard -->
```{r biomass-phase-wcvi, fig.show = "hide", fig.asp = 1}
plot_f <- plot_biomass_phase(major_models[[model_ind]],
                             ct,
                             new_surv_yr = new_surv_yr,
                             point_size = 2.5,
                             line_size = 0.5,
                             path_line_size = 0.4,
                             text_size = 2,
                             zeroline_size = 0.5,
                             zeroline_type = "dashed",
                             lrp_ribbon_alpha = 0.35,
                             refpt_show = "0.3sbo",
                             show_x_axis = TRUE,
                             show_y_axis = TRUE,
                             x_axis_label_size = x_axis_label_size,
                             x_axis_tick_label_size = x_axis_tick_label_size,
                             y_axis_label_size = y_axis_label_size,
                             y_axis_tick_label_size = y_axis_tick_label_size,
                             x_axis_label_newline_length = x_axis_label_newline_length,
                             y_axis_label_newline_length = y_axis_label_newline_length,
                             annot = "f",
                             translate = french)
```
<!-- West Coast of Vancouver Island Storyboard -->
(ref:storyboard-wcvi-cap) Model output for Pacific Herring in the West Coast of Vancouver Island major stock assessment region. See Figure \@ref(fig:storyboard-hg) for description.

(ref:storyboard-wcvi-cap-french) Production d’un modèle pour le hareng du Pacifique dans la principale région d’évaluation des stocks de la côte ouest de l’île de Vancouver. Voir la figure \@ref(fig:storyboard-hg) pour une description.

```{r storyboard-wcvi, out.height="6.5in", fig.asp=1, fig.cap = ifelse(french, "(ref:storyboard-wcvi-cap-french)", "(ref:storyboard-wcvi-cap)")}

cowplot::plot_grid(plot_a,
                   plot_b,
                   plot_c,
                   plot_d,
                   plot_e,
                   plot_f,
                   ncol = 2,
                   align = "v",
                   rel_heights = c(1.0, 1.0, 1.1))

```

(ref:harvest-rate-cap) `r paste0("Time series of effective harvest rate for Pacific Herring from ", major_start_yr, " to ", assess_yr, " in the major stock assessment regions. Effective harvest rate in year $t$, $U_t$ is calculated as $U_t = C_t/(C_t + \\mli{SB}_t)$ where $C_t$ is catch in year $t$, and $\\mli{SB}_t$ is estimated spawning biomass in year $t$. Black lines and shaded ribbons indicate medians and ", ci_level*100, "\\% confdence intervals for spawning biomass, respectively. Horizontal dashed lines indicate $U_t =",  target_hr, "$.")`

(ref:harvest-rate-cap-french) `r paste0("Série chronologique du taux de récolte effectif pour le hareng du Pacifique de ", major_start_yr, " à ", assess_yr, " dans les principales régions d’évaluation des stocks. Le taux de récolte effectif pour l’année t, Ut est calculé comme $U_t = C_t/(C_t + BSR_t)$ où $C_t$ est est la prise pour l’année $t$, et la $BSR_t$ est la biomasse reproductrice estimée pour l’année $t$. Les lignes noires indiquent les médianes et les zones ombragées indiquent les intervalles de confiance de 90\\% pour la biomasse reproductrice, $BSR_t$. Les lignes en tirets horizontales indiquent $U_t = 0,2$.")`

```{r harvest-rate, fig.asp = 1, fig.cap = ifelse(french, "(ref:harvest-rate-cap-french)", "(ref:harvest-rate-cap)")}
plot_harvest_rate(major_catch,
                  major_models,
                  major_regions_full,
                  line_size = 1,
                  ribbon_alpha = 0.35,
                  ylim = c(0, 1),
                  h_line = target_hr,
                  translate = french)
```

(ref:proj-biomass-density-cap) `r paste0("Projected spawning biomass assuming no fishing in ", assess_yr + 1, " $\\mli{SB}_{", assess_yr + 1, "}$ in thousands of tonnes (t) for Pacific Herring in the major stock assessment regions. Solid and dashed vertical lines indicate medians and ", ci_level*100, "\\% confdence intervals for $SB_{", assess_yr + 1, "}$, respectively. Vertical red lines and shaded red areas indicate medians and ", ci_level*100, "\\% confdence intervals for the limit reference point, $0.3\\mli{SB}_0$, respectively, where $\\mli{SB}_0$ is estimated unfshed biomass.")`

(ref:proj-biomass-density-cap-french) `r paste0("Biomasse reproductrice projetée en supposant qu’il n’y aura pas de pêche en ", assess_yr + 1, ", $BSR_{", assess_yr + 1, "}$ en milliers de tonnes pour le hareng du Pacifique dans les principales régions d’évaluation des stocks. Les lignes noires verticales indiquent les médianes (lignes pleines) et les intervalles de confiance de 90\\% (lignes tiretées) pour la $BSR_{", assess_yr + 1, "}$. Les lignes rouges verticales indiquent les médianes et les rectangles rouges ombragés indiquent les intervalles de confiance de 90\\% pour le point de référence limite, $0,3BSR_0$, où $BSR_0$ est la biomasse non exploitée estimée.")`

```{r proj-biomass-density, fig.asp = 1, fig.cap = ifelse(french, "(ref:proj-biomass-density-cap-french)", "(ref:proj-biomass-density-cap)")}
plot_proj_biomass_density(major_models, 
                          major_regions_full, 
                          yr = assess_yr + 1,
                          tac = 0,
                          refpt = "X03B0",
                          line_size = 1,
                          ribbon_alpha = 0.35,
                          translate = french)
```
