# Strait of Georgia diagnostics

This section contains MCMC diagnostics for the Strait of Georgia major stock assessment region SCA model.
These tables and figures will not be included in the final Science Response.

```{r sog-parameter-est-table, results = 'asis', echo = FALSE}
cap <- paste0("Posterior (5\\textsuperscript{th} percentile, Median, and ",
              "95\\textsuperscript{th} percentile) and MPD estimates of key ",
              "parameters for the Strait of Georgia major stock assessment",
              "region. Subscripts on $q$ ",
              "(catchability) indicate: 1 = Surface survey, 2 = Dive survey. ",
              "Tau ($\\tau$) and sigma ($\\sigma$) are calculated values.")
model_ind <- match(en2fr("SoG", french), major_regions_short)
make.parameters.est.table(major_models[[model_ind]],
                          xcaption = cap,
                          xlabel = "tab:sog-parameter-est-table",
                          font.size = 11,
                          space.size = 12,
                          placement = "H")
```

```{r sog-recruitment-table, results = 'asis', echo = FALSE}
cap <- paste0("Posterior (5\\textsuperscript{th} percentile, Median, and ",
              "95\\textsuperscript{th} percentile) and MPD estimates of ",
              "recruitment (millions) for the Strait of Georgia major stock",
              "assessment region.")
make.value.table(major_models[[model_ind]],
                 type = 2,
                 syr = 2007,
                 xcaption = cap,
                 xlabel = "tab:sog-recruitment-table",
                 font.size = 11,
                 space.size = 12,
                 placement = "H")
                 ##tabular.environment = "longtable")
```

```{r sog-priors-posts-figure, fig.cap = "Prior probability distributions (lines) with comparative posterior histograms (bars) used in the Strait of Georgia major stock assessment region. Parameters $q_k$ represent gears where: $k=1$ is the surface survey and $k=2$ is the dive survey. The dotted red lines are the MPD estimates."}
make.priors.posts.plot(major_models[[model_ind]],
                       priors.only = FALSE)
```

```{r sog-traces-figure, fig.asp=1, fig.cap = paste0("Trace plots for MCMC output of estimated parameters for the Strait of Georgia major stock assessment region. The MCMC run had chain length ", mcmc_length, " with a sample taken at every ", f(mcmc_samp_freq), "th iteration. The catchability parameter $q_1$ represents the surface survey and $q_2$ the dive survey. Parameters $\\hat{a}_k$ (selectivity-at-age-50\\%), and $\\hat{\\gamma}_k$ (selectivity standard deviation-at-50\\%) represent gears as follows: $k=1$: Other fisheries, $k=2$: Roe seine, $k=3$: Gillnet roe.")}
make.traces.plot(major_models[[model_ind]],
                 axis.lab.freq = 200)
```

(ref:sog-autocor-figure) Autocorrelation plots for MCMC output of estimated parameters for the Strait of Georgia major stock assessment region. See Figure \@ref(fig:sog-traces-figure) for parameter descriptions.
```{r sog-autocor-figure, fig.asp=1, fig.cap = "(ref:sog-autocor-figure)"}
make.autocor.plot(major_models[[model_ind]])
```

(ref:sog-pairs-figure) Pairs plots for MCMC output of estimated parameters for the Strait of Georgia major stock assessment region. See Figure \@ref(fig:sog-traces-figure) for parameter descriptions.
```{r sog-pairs-figure, fig.asp=1, fig.cap = "(ref:sog-pairs-figure)"}
make.pairs.plot(major_models[[model_ind]])
```

(ref:sog-biomass-retro-figure) MPD biomass with retrospectivces for the Strait of Georgia major stock assessment region.
```{r sog-biomass-retro-figure, fig.cap = "(ref:sog-biomass-retro-figure)"}
biomass.plot.mpd(major_models[[model_ind]])
```

(ref:decision-table-sog) `r paste0("Projected spawning biomass for ", assess_yr + 1, " compared to harvest rate and TAC for the Strait of Georgia region, rows 1-6 in Table @\ref(tab:decision-table-sog)")`
```{r hcr-sog, fig.cap = "(ref:decision-table-sog)"}
region <- "SoG"
probs <- confidence_vals 
cowplot::plot_grid(plot_hcr(mp.lst.sog[[1]][[1]],
                            sbt.sog,
                            mp = mp.sog[1,]$label,
                            region = region,
                            probs = probs),
                   plot_hcr(mp.lst.sog[[1]][[2]],
                            sbt.sog,
                            mp = mp.sog[2,]$label,
                            region = region,
                            probs = probs),
                   plot_hcr(mp.lst.sog[[1]][[3]],
                            sbt.sog,
                            mp = mp.sog[3,]$label,
                            region = region,
                            probs = probs),
                   plot_hcr(mp.lst.sog[[1]][[4]],
                            sbt.sog,
                            mp = mp.sog[4,]$label,
                            region = region,
                            probs = probs),
                   plot_hcr(mp.lst.sog[[1]][[5]],
                            sbt.sog,
                            mp = mp.sog[5,]$label,
                            region = region,
                            probs = probs,
                            show.x.axes = TRUE),
                   plot_hcr(mp.lst.sog[[1]][[6]],
                            sbt.sog,
                            mp = mp.sog[6,]$label,
                            region = region,
                            probs = probs,
                            show.x.axes = TRUE),
                   nrow = 3,
                   ncol = 2,
                   align = "hv",
                   axis = "tblr")
```
(ref:decision-table-sog-2) `r paste0("Projected spawning biomass for ", assess_yr + 1, " compared to harvest rate and TAC for the Strait of Georgia region, rows 7-10 in Table @\ref(tab:decision-table-sog)")`
```{r hcr-sog-2, fig.cap = "(ref:decision-table-sog-2)"}
region <- "SoG"
probs <- confidence_vals 
cowplot::plot_grid(plot_hcr(mp.lst.sog[[1]][[7]],
                            sbt.sog,
                            mp = mp.sog[7,]$label,
                            region = region,
                            probs = probs),
                   plot_hcr(mp.lst.sog[[1]][[8]],
                            sbt.sog,
                            mp = mp.sog[8,]$label,
                            region = region,
                            probs = probs),
                   plot_hcr(mp.lst.sog[[1]][[9]],
                            sbt.sog,
                            mp = mp.sog[9,]$label,
                            region = region,
                            probs = probs),
                   plot_hcr(mp.lst.sog[[1]][[10]],
                            sbt.sog,
                            mp = mp.sog[10,]$label,
                            region = region,
                            probs = probs),
                   nrow = 2,
                   ncol = 2,
                   align = c("v", "h"))
```
